{"version":3,"file":"modifier.js","sources":["../../src/floating-ui/modifier.ts"],"sourcesContent":["import { assert } from '@ember/debug';\n\nimport { autoUpdate, computePosition, flip, hide, offset, shift } from '@floating-ui/dom';\nimport { modifier as eModifier } from 'ember-modifier';\n\nimport { exposeMetadata } from './middleware.ts';\n\nimport type {\n  FlipOptions,\n  HideOptions,\n  Middleware,\n  OffsetOptions,\n  Placement,\n  ShiftOptions,\n  Strategy,\n} from '@floating-ui/dom';\n\nexport interface Signature {\n  /**\n   *\n   */\n  Element: HTMLElement;\n  Args: {\n    Positional: [\n      /**\n       * What do use as the reference element.\n       * Can be a selector or element instance.\n       *\n       * Example:\n       * ```gjs\n       * import { anchorTo } from 'ember-primitives/floating-ui';\n       *\n       * <template>\n       *   <div id=\"reference\">...</div>\n       *   <div {{anchorTo \"#reference\"}}> ... </div>\n       * </template>\n       * ```\n       */\n      referenceElement: string | HTMLElement | SVGElement,\n    ];\n    Named: {\n      /**\n       * This is the type of CSS position property to use.\n       * By default this is 'fixed', but can also be 'absolute'.\n       *\n       * See: [The strategy docs](https://floating-ui.com/docs/computePosition#strategy)\n       */\n      strategy?: Strategy;\n      /**\n       * Options to pass to the [offset middleware](https://floating-ui.com/docs/offset)\n       */\n      offsetOptions?: OffsetOptions;\n      /**\n       * Where to place the floating element relative to its reference element.\n       * The default is 'bottom'.\n       *\n       * See: [The placement docs](https://floating-ui.com/docs/computePosition#placement)\n       */\n      placement?: Placement;\n      /**\n       * Options to pass to the [flip middleware](https://floating-ui.com/docs/flip)\n       */\n      flipOptions?: FlipOptions;\n      /**\n       * Options to pass to the [shift middleware](https://floating-ui.com/docs/shift)\n       */\n      shiftOptions?: ShiftOptions;\n      /**\n       * Options to pass to the [hide middleware](https://floating-ui.com/docs/hide)\n       */\n      hideOptions?: HideOptions;\n      /**\n       * Additional middleware to pass to FloatingUI.\n       *\n       * See: [The middleware docs](https://floating-ui.com/docs/middleware)\n       */\n      middleware?: Middleware[];\n      /**\n       * A callback for when data changes about the position / placement / etc\n       * of the floating element.\n       */\n      setData?: Middleware['fn'];\n    };\n  };\n}\n\n/**\n * A modifier to apply to the _floating_ element.\n * This is what will anchor to the reference element.\n *\n * Example\n * ```gjs\n * import { anchorTo } from 'ember-primitives/floating-ui';\n *\n * <template>\n *   <button id=\"my-button\"> ... </button>\n *   <menu {{anchorTo \"#my-button\"}}> ... </menu>\n * </template>\n * ```\n */\nexport const anchorTo = eModifier<Signature>(\n  (\n    floatingElement,\n    [_referenceElement],\n    {\n      strategy = 'fixed',\n      offsetOptions = 0,\n      placement = 'bottom',\n      flipOptions,\n      shiftOptions,\n      middleware = [],\n      setData,\n    }\n  ) => {\n    const referenceElement: null | HTMLElement | SVGElement =\n      typeof _referenceElement === 'string'\n        ? document.querySelector(_referenceElement)\n        : _referenceElement;\n\n    assert(\n      'no reference element defined',\n      referenceElement instanceof HTMLElement || referenceElement instanceof SVGElement\n    );\n\n    assert(\n      'no floating element defined',\n      floatingElement instanceof HTMLElement || _referenceElement instanceof SVGElement\n    );\n\n    assert(\n      'reference and floating elements cannot be the same element',\n      floatingElement !== _referenceElement\n    );\n\n    assert('@middleware must be an array of one or more objects', Array.isArray(middleware));\n\n    Object.assign(floatingElement.style, {\n      position: strategy,\n      top: '0',\n      left: '0',\n    });\n\n    let update = async () => {\n      let { middlewareData, x, y } = await computePosition(referenceElement, floatingElement, {\n        middleware: [\n          offset(offsetOptions),\n          flip(flipOptions),\n          shift(shiftOptions),\n          ...middleware,\n          hide({ strategy: 'referenceHidden' }),\n          hide({ strategy: 'escaped' }),\n          exposeMetadata(),\n        ],\n        placement,\n        strategy,\n      });\n\n      let referenceHidden = middlewareData.hide?.referenceHidden;\n\n      Object.assign(floatingElement.style, {\n        top: `${y}px`,\n        left: `${x}px`,\n        margin: 0,\n        visibility: referenceHidden ? 'hidden' : 'visible',\n      });\n\n      setData?.(middlewareData['metadata']);\n    };\n\n    update();\n\n    let cleanup = autoUpdate(referenceElement, floatingElement, update);\n\n    /**\n     * in the function-modifier manager, teardown of the previous modifier\n     * occurs before setup of the next\n     * https://github.com/ember-modifier/ember-modifier/blob/main/ember-modifier/src/-private/function-based/modifier-manager.ts#L58\n     */\n    return cleanup;\n  }\n);\n"],"names":["anchorTo","eModifier","floatingElement","_referenceElement","strategy","offsetOptions","placement","flipOptions","shiftOptions","middleware","setData","referenceElement","document","querySelector","assert","HTMLElement","SVGElement","Array","isArray","Object","assign","style","position","top","left","update","middlewareData","x","y","computePosition","offset","flip","shift","hide","exposeMetadata","referenceHidden","margin","visibility","cleanup","autoUpdate"],"mappings":";;;;;AAsFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACO,MAAMA,QAAQ,GAAGC,QAAS,CAC/B,CACEC,eAAe,EACf,CAACC,iBAAiB,CAAC,EACnB;AACEC,EAAAA,QAAQ,GAAG,OAAO;AAClBC,EAAAA,aAAa,GAAG,CAAC;AACjBC,EAAAA,SAAS,GAAG,QAAQ;EACpBC,WAAW;EACXC,YAAY;AACZC,EAAAA,UAAU,GAAG,EAAE;AACfC,EAAAA;AACF,CAAC,KACE;AACH,EAAA,MAAMC,gBAAiD,GACrD,OAAOR,iBAAiB,KAAK,QAAQ,GACjCS,QAAQ,CAACC,aAAa,CAACV,iBAAiB,CAAC,GACzCA,iBAAiB;EAEvBW,MAAM,CACJ,8BAA8B,EAC9BH,gBAAgB,YAAYI,WAAW,IAAIJ,gBAAgB,YAAYK,UACzE,CAAC;EAEDF,MAAM,CACJ,6BAA6B,EAC7BZ,eAAe,YAAYa,WAAW,IAAIZ,iBAAiB,YAAYa,UACzE,CAAC;AAEDF,EAAAA,MAAM,CACJ,4DAA4D,EAC5DZ,eAAe,KAAKC,iBACtB,CAAC;EAEDW,MAAM,CAAC,qDAAqD,EAAEG,KAAK,CAACC,OAAO,CAACT,UAAU,CAAC,CAAC;AAExFU,EAAAA,MAAM,CAACC,MAAM,CAAClB,eAAe,CAACmB,KAAK,EAAE;AACnCC,IAAAA,QAAQ,EAAElB,QAAQ;AAClBmB,IAAAA,GAAG,EAAE,GAAG;AACRC,IAAAA,IAAI,EAAE;AACR,GAAC,CAAC;AAEF,EAAA,IAAIC,MAAM,GAAG,YAAY;IACvB,IAAI;MAAEC,cAAc;MAAEC,CAAC;AAAEC,MAAAA;AAAE,KAAC,GAAG,MAAMC,eAAe,CAAClB,gBAAgB,EAAET,eAAe,EAAE;MACtFO,UAAU,EAAE,CACVqB,MAAM,CAACzB,aAAa,CAAC,EACrB0B,IAAI,CAACxB,WAAW,CAAC,EACjByB,KAAK,CAACxB,YAAY,CAAC,EACnB,GAAGC,UAAU,EACbwB,IAAI,CAAC;AAAE7B,QAAAA,QAAQ,EAAE;OAAmB,CAAC,EACrC6B,IAAI,CAAC;AAAE7B,QAAAA,QAAQ,EAAE;AAAU,OAAC,CAAC,EAC7B8B,cAAc,EAAE,CACjB;MACD5B,SAAS;AACTF,MAAAA;AACF,KAAC,CAAC;AAEF,IAAA,IAAI+B,eAAe,GAAGT,cAAc,CAACO,IAAI,EAAEE,eAAe;AAE1DhB,IAAAA,MAAM,CAACC,MAAM,CAAClB,eAAe,CAACmB,KAAK,EAAE;MACnCE,GAAG,EAAE,CAAGK,EAAAA,CAAC,CAAI,EAAA,CAAA;MACbJ,IAAI,EAAE,CAAGG,EAAAA,CAAC,CAAI,EAAA,CAAA;AACdS,MAAAA,MAAM,EAAE,CAAC;AACTC,MAAAA,UAAU,EAAEF,eAAe,GAAG,QAAQ,GAAG;AAC3C,KAAC,CAAC;AAEFzB,IAAAA,OAAO,GAAGgB,cAAc,CAAC,UAAU,CAAC,CAAC;GACtC;AAEDD,EAAAA,MAAM,EAAE;EAER,IAAIa,OAAO,GAAGC,UAAU,CAAC5B,gBAAgB,EAAET,eAAe,EAAEuB,MAAM,CAAC;;AAEnE;AACJ;AACA;AACA;AACA;AACI,EAAA,OAAOa,OAAO;AAChB,CACF;;;;"}